\documentclass[a4paper,12pt]{article}
\usepackage[latin1]{inputenc}
\usepackage{vmargin}
\usepackage{fancyhdr}
\usepackage[catalan]{babel}
\usepackage{graphicx}

\setmargnohfrb{2.5cm}{2.5cm}{2.5cm}{2.5cm}

\fancypagestyle{plain}{%
  \fancyhf{}
  \fancyfoot[C]{\footnotesize\textrm{\thepage}}
  \renewcommand{\headrulewidth}{0pt}%
}
\pagestyle{plain}

\renewcommand{\baselinestretch}{1.3}

\makeindex

\begin{document}

\tableofcontents
\newpage

\section{Com usar aquesta memòria}
\section{Objectius i motivacions}
\section{Introducció}
\subsection{El format DEM}
\paragraph{}
El format DEM\footnote{Especificació: http://rockyweb.cr.usgs.gov/nmpstds/acrodocs/dem/2DEM0198.PDF} (Digital Elevation Model) va ser creat per l'USGS \textit{(United States Geological Survey)} per guardar la informació de les seves mesures de la superfície dels Estats Units.
\paragraph{}
Un fitxer DEM està organitzat en tres tipus de registres lògics: A, B i C. 
\begin{itemize}
\item El tipus de registre A conté informació en quant les característiques generals del mapa, nom, límits, unitats de mesua, elevació mínima i màxima, el número de registres de tipus B, etc. Només hi ha un registre de tipus A per fitxer.
\item Els registres de tipus B contenen la informació de les alçades propiament dita.
\item El tipus de registre C conté estàdistiques en quant a l'exactitud de les dades del fitxer.
\end{itemize}
\paragraph{}
Degut a que el format DEM estava pensat per emmagatzemar-se en cintes magnètiques, l'especificació del format parla de registres físics, cadascun de 1024 bytes. En un registre físic no hi pot haver més d'un registre lògic, en canvi és usual que els registres lògics de tipus B ocupin més d'un registre lògic. Les parts d'un registre físic no ocupades per la informació d'un registre lògic s'han d'omplir amb blancs. Els registres lògics de tipus A i C mai ocupen més d'un registre físic.
\paragraph{}
Els fitxers DEM divideixen el mapa en una graella i proporcionen l'alçada de cadascun dels punts de la graella. Cada registre de tipus B té la informació de les alçades d'una columna d'aquesta graella, es a dir, si la graella d'un mapa tinguès n columnes i m files hi hauria n registres de tipus B cadascun amb m alçades.
\paragraph{}
Hi ha tres tipus de fitxers DEM:
\begin{enumerate}
\item \textbf{DEM d'1 grau:} Tenen 1201*1201 punts de dades, estan basats en latitud-longitud i l'espaiat entre els punts de la graella és de 3 segons d'arc, que és aproximadament 90 metres, encara que obviament depèn de la latitud.
\item \textbf{DEM de 30 minuts:} Són 4 unitats de fitxers DEM d'1 grau distribuïdes de forma conjunta, són el menys comú dels 3 tipus.
\item \textbf{DEM de 7.5 minuts:} L'espaiat entre els punts de la graella pot ser de 30 o 10 metres (1 segon d'arc i 1/3 de segon d'arc respectivament), els límits del fitxer estan basats en latitud-longitud, però en canvi els punts de dades es donen en coordenada x-y d'una projecció Mercator, resultant en fitxers on no tots registres de tipus B tenen la mateixa longitud. (Figura \ref{fig: dem})
\end{enumerate}

\begin{figure}
\centering
\includegraphics{images/dem75.png}
\caption{Esquema d'un DEM de 7.5 minuts}
\label{fig: dem}
\end{figure}



\section{Especificació}
\subsection{Què és r3v?}
\subsection{Què és libroam?}
\subsection{Requeriments no funcionals}
\subsection{Requeriments funcionals}
\subsection{Model Conceptual}
\subsubsection{Restriccions d'integritat}
\subsection{Model de casos d'ús}

\begin{figure}
\centering
\includegraphics{images/casosUs.png}
\caption{Diagrama de casos d'ús}
\label{fig: casosUs}
\end{figure}

\paragraph{}
Com es pot veure a la figura \ref{fig: casosUs} l'aplicació $r3v$ disposa d'un petit número de casos d'ús.

\section{Disseny}

\subsection{Arbres binaris de triangles}
\paragraph{}
Un arbre binari de triangles és un arbre per organitzar triangles de forma jeràrquica. El triangle arrel $T = (v_a, v_0, v_1)$ és un triangle isòsceles amb àpex $v_a$. Els fills de l'arrel es defineixen partint l'arrel en dos parts fent crent una nova aresta que va des del vèrtex $v_a$ al punt mig $v_c$ de l'aresta base (aresta entre $v_0$ i $v_1$). El fill esquerre de $T$ és $T_0 = (v_c, v_a, v_0)$ mentre que el fill dret és $T_1 = (v_c, v_1, v_a)$. La resta de de l'estructura de l'arbre de triangles és una repetició recursiva del procés de partició explicat anteriorment. Dins de l'arbre cada triangle té un nivell $l$ definit pel nombre de vegades que s'ha partit al triangle arrel per arribar a generar aquell triangle en concret. A la figura \ref{fig: triangles} podem veure una representació dels nivells 0 a 5 d'un arbre binari de triangles.

\begin{figure}
\centering
\includegraphics{images/triangles.png}
\caption{Representació dels nivells 0 a 5 d'un arbre binari de triangles}
\label{fig: triangles}
\end{figure}

\subsubsection{Representació de superfícies amb arbres binaris}
\paragraph{}
Per representar una superfície amb arbres binaris de triangles es fan servir dos arbres de triangles situats de forma que comparteixin la seva aresta base, d'aquesta forma es cubreix una superfície quadrada (Figura \ref{fig: diamant}). Un cop tenim una estructura que permet cubrir tot un quadrat només cal assignar a cada vèrtex una alçada $w(v)$ per tenir una forma eficient de guardar les alçades d'un terreny.

\begin{figure}
\centering
\includegraphics{images/diamant.png}
\caption{Dos arbres de triangles serveixen per representar una superfície quadrada}
\label{fig: diamant}
\end{figure}

\subsubsection{Conjunts d'arbres binaris de triangles}
\paragraph{}
Una a triangulació d'arbres binaris de triangles (triangulació d'ara en endavant) és un conjunt d'arbres binaris que tenen alguna relació de veïnatge entre ells, ja sigui compartint un vèrtex o una aresta. Un cas especial de triangulació és el diamant, triangulació format per dos triangles que comparteixen l'aresta base i tenen el mateix nivell, la figura \ref{fig: diamant} és un exemple de diamant. Un fet important d'una triangulació és que donat un triangle, el triangle amb el que comparteix la base és del mateix nivell o del nivell superior. A la figura \ref{fig: triangleBase} podem veure un exemple de les dues situacions, el triangle A comparteix la base amb un triangle del seu nivell mentre que el triangle B comparteix la base amb un triangle d'un nivell superior ($l$ més petita).

\begin{figure}
\centering
\includegraphics{images/triangleBase.png}
\caption{Possibilitats de compartir la base}
\label{fig: triangleBase}
\end{figure}

\subsubsection{Operacions sobre diamants}
\paragraph{}
Sobre un diamant es poden realitzar dues operacions, split i merge. Split (partir) consisteix en crear els fills de $T$ i del seu triangle base $T_B$ de forma que s'obté una triangulació formada pels triangles $T_1$, $T_2$, $T_B1$ i $T_B2$. Merge (fusionar) consisteix en tornar als triangles $T$ i $T_B$ a partir dels seus quatre fills. Es pot veure una representació dels processos de partició i unió a la figura \ref{fig: splitMerge}.

\begin{figure}
\centering
\includegraphics{images/splitMerge.png}
\caption{Split i merge sobre una triangulació}
\label{fig: splitMerge}
\end{figure}

\paragraph{}
Només els triangles que tenen el mateix nivell que el triangle amb el que comparteixen la base són susceptibles de ser partits. Aquells que comparteixen la base amb un triangle de nivell superior ($l$ més petita) (per exemple el triangle B de la figura \ref{fig: triangleBase})  no poden ser partits directament i si realment volem partir-los hem de fer abans un split del triangle amb el que comparteix la base. La figura \ref{fig: forceSplitExtrem} és un cas extrem en el que caldria fer 4 splits forçats abans de fer la partició del triangle $T$.

\begin{figure}
\centering
\includegraphics{images/forceSplitExtrem.png}
\caption{Cas extrem en el que cal aplicar 4 particions forçades}
\label{fig: forceSplitExtrem}
\end{figure}

\paragraph{}
En primera instància es pot pensar que no seria necessari que l'operació de split s'apliquès sobre un diamant i que es podria fer sobre un triangle sol, però això no es possible ja que crearia una discontinuitat en la superfície. A la figura \ref{fig: discontinuitat} veiem la representació resultant de partir només un dels triangles del diamant d'una superfície en la que els punts $(0, 0)$, $(0, 1)$, $(1, 0)$ i $(1, 1)$ tenen una alçada de 0 mentre que el punt $(0.5, 0.5)$ té una alçada de 1.

\begin{figure}
\centering
\includegraphics{images/discontinuitat.png}
\caption{Discontinuitat: Resultat de partir un triangle i no un diamant}
\label{fig: discontinuitat}
\end{figure}

\subsection{Escala de colors}
\paragraph{}

\section{Implementació}
\subsection{Lector de format DEM}
\paragraph{}

\section{Recursos i Anàlisi de costos}
\subsection{Recursos humans i tecnològics}
\subsection{Anàlisi de costos}
\section{Conclusions}
\section{Bibliografia}
\section{Index de figures}
\listoffigures
\end{document}
